https://cdn.intra.42.fr/pdf/pdf/57354/en.subject.pdf
https://medium.com/freestoneinfotech/simplifying-docker-compose-operations-using-makefile-26d451456d63
https://mariadb.com/kb/en/creating-a-custom-docker-image/
https://medium.com/swlh/wordpress-deployment-with-nginx-php-fpm-and-mariadb-using-docker-compose-55f59e5c1a
https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-with-docker-compose


$ docker build .
$ docker run -d -p 80:80



# syntax=docker/dockerfile:1
FROM python:3.10 as pythonvenv

FROM pythonvenv AS python-deps

# Install pipenv and dependencies
RUN pip install pipenv

# Install dependencies in /.venv
COPY ./Pipfile.lock .
COPY ./Pipfile .
RUN PIPENV_VENV_IN_PROJECT=1 pipenv install --deploy --ignore-pipfile

FROM pythonvenv AS runtime

# Copy virtual env from python-deps stage
COPY --from=python-deps /.venv /.venv
ENV PATH="/.venv/bin:$PATH"

# Create a new user
RUN useradd --create-home app_usr
WORKDIR /home/app_usr

# Copy entrypoint.sh, Gunicorn config file
COPY ./entrypoint.sh .
COPY ./gunicorn.conf.py .

# update permissions
RUN chmod a+x ./entrypoint.sh

# Switch to the new user
USER app_usr

# Install application into container
COPY  --chown=app_usr app .

# run entrypoint.sh and the Django application
ENTRYPOINT ["/home/app_usr/entrypoint.sh"]
